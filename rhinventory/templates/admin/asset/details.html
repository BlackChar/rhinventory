{% extends 'admin/model/details.html' %}

{# XXX https://github.com/flask-admin/flask-admin/blob/master/flask_admin/templates/bootstrap2/admin/model/details.html#L5 #}
{% block navlinks %}
    {% from 'admin/asset/menu_bar.html' import asset_menu_bar with context %}
    {{ asset_menu_bar() }}
{% endblock %}

{% block details_table %}
    <div style="margin-bottom: 8px;">
        <a href="{{ url_for('label_asset', asset_id=model.id, small=False) }}" class="btn btn-light">
            RH label
        </a>
        <a href="rhprint:{{model.id}}" id="print-label" class="btn btn-primary">
            {{ icon("print") }} Print RH label
        </a>
        <a href="{{ url_for('label_asset', asset_id=model.id, small=False, logo_ha=True) }}" class="btn btn-light">
            HA label
        </a>
        <a href="rhprint:{{model.id}}-ha" id="print-label" class="btn btn-primary">
            {{ icon("print") }} Print HA label
        </a>
    </div>
    <div style="margin-bottom: 8px;">
        <a href="{{ url_for('label_asset', asset_id=model.id, small=True) }}" class="btn btn-light">
            RH small label
        </a>
        <a href="rhprint:{{model.id}}-small" id="print-label" class="btn btn-primary">
            {{ icon("print") }} Print RH small label
        </a>
    </div>

    <h2>{{ model }}</h2>
    {% if model.category.expose_number %}
        {{ model.organization.shortname }}{{ model.id }}<br>
    {% endif %}
    <strong>Manufacturer</strong>: {{ model.manufacturer }}

    {{ super() }}

    <h2>{{ icon("file") }} Files</h2>

    <div style="margin-bottom: 8px">
        <strong>Attach files to this asset</strong>:
        <form method="POST" enctype="multipart/form-data" action="{{ url_for('file.upload_view', id=model.id) }}" style="display: inline;">
            {{ file_form.files }}
            {{ file_form.category }}
            <input type="submit" value="Submit" class="btn btn-primary" style="vertical-align: top;">
        </form>
    </div>

    <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
        {% for file in model.files %}
            {% if file.is_image %}
                <div style="width: 300px; max-width: 100%; border: 1px solid #bbb; border-radius: 2px; padding: 4px; margin: 4px;
                            display: flex; flex-direction: column; justify-content: space-between;">
                    <div>
                        <a href="{{ url_for('file.details_view', id=file.id) }}">
                            {% if file.has_thumbnail %}
                                <img src="{{ url_for('files.static', filename=file.filepath_thumbnail) }}">
                            {% else %}
                                (Thumbnail missing)
                            {% endif %}
                        </a>
                    </div>
                    <div>
                        <a href="{{ url_for('file.edit_view', id=file.id) }}">
                            <span class="fa fa-pencil glyphicon icon-pencil"></span>
                        </a>
                        {% if file.primary %}
                            <span class="fa fa-eye glyphicon icon-star"></span>
                        {% endif %}
                        <a href="{{ url_for('file.details_view', id=file.id) }}">
                            {{ file.filename }}
                        </a>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <table class="table table-hover table-bordered">
        <tr>
            <th></th>
            <th>Path</th>
            <th>Category</th>
        </tr>
    {% for file in model.files %}
    <tr>
        <td>
            <a href="{{ url_for('file.edit_view', id=file.id) }}">
               <span class="fa fa-pencil glyphicon icon-pencil"></span>
            </a>

            <a href="{{ url_for('file.details_view', id=file.id) }}">
                <span class="fa fa-eye glyphicon icon-eye-open"></span>
            </a>
        </td>
        <td>
            {% if file.primary %}
                <span class="fa fa-eye glyphicon icon-star"></span>
            {% endif %}
            <a href="{{ url_for('file.details_view', id=file.id) }}">
                {{ file.filepath }}
            </a>
        </td>
        <td>{{ file.category }}</td>
    </tr>
    {% endfor %}
    </table>

    <h2>{{ icon("handshake-angle") }} Transaction history</h2>

    <div style="margin-bottom: 8px">
        <a href="{{ url_for('transaction.create_view', asset_id=model.id) }}" class="btn btn-primary">
            {{ icon("plus-circle") }} Add new transaction
        </a>
    </div>

    <table class="table table-hover table-bordered">
        <tr>
            <th>Date</th>
            <th>Transaction type</th>
            <th>Note</th>
            <th>Together with</th>
            <th></th>
        </tr>
    {% for transaction in model.transactions %}
    <tr>
        <td>{{ transaction.date }}</td>
        <td>{{ transaction.transaction_type.name }}</td>
        <td>{{ transaction.note }}</td>
        <td>
            <ul>
            {% for asset in transaction.assets %}
                <li><a href="{{ url_for('asset.details_view', id=asset.id) }}">{{asset.name}} (id: {{asset.id}})</a></li>
            {% endfor %}
            </ul>
        </td>
        <td>
            <a href="{{ url_for('transaction.edit_view', id=transaction.id) }}">
               <span class="fa fa-pencil glyphicon icon-pencil"></span>
            </a>

            <a href="{{ url_for('transaction.details_view', id=transaction.id) }}">
                <span class="fa fa-eye glyphicon icon-eye-open"></span>
            </a>
        </td>
    </tr>
    {% endfor %}
    </table>


    <h2>{{ icon("file-lines") }} Edit Logs</h2>

    <table class="table table-hover table-bordered">
        <tr>
            <th>User</th>
            <th>Date</th>
            <th>Event</th>
            <th>Details</th>
        </tr>
    {% for log in logs %}
    <tr>
        <td>{{ log.user }}</td>
        <td>{{ log.date }}</td>
        <td>{{ log.event }}</td>
        <td>{{ log.object_json }}</td>
    </tr>
    {% endfor %}
    </table>


{% endblock %}