{% extends 'admin/model/list.html' %}

{% block model_menu_bar %}
    {% from 'admin/asset/menu_bar.html' import asset_menu_bar with context %}
    {{ asset_menu_bar() }}
{% endblock %}

{% block tail %}
    {{ super() }}
    <style>
        body {
            margin-bottom: 32px;
        }
        .selected {
            position: fixed;
            bottom: 0;
            right: 0;
            margin: 4px;
            padding: 4px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 3px;
            max-width: 50%;
        }

        .selected-buttons {
            text-align: right;
        }
    </style>
    <div class="selected">
        <div id="selected-list">
        </div>
        <div class="selected-buttons">
            <button id="selected-clear">Clear</button>
            <button id="selected-show-sheet">Show sheet</button>
            <button id="selected-create-transaction">Create transaction</button>
        </div>
    </div>
    <script>
        var selected = [];

        var selected_local_storage = localStorage.getItem("selected")
        if (selected_local_storage) {
            selected = JSON.parse(selected_local_storage);
        }

        function showSelected() {
            localStorage.setItem("selected", JSON.stringify(selected));
            document.getElementById('selected-list').innerHTML = selected.join(', ');
        }

        showSelected()

        document.getElementById("add-to-sheet").onclick = function() {
            // iterate over all elements with class action-checkbox
            var checkboxes = document.getElementsByClassName("action-checkbox");
            for (var i = 0; i < checkboxes.length; i++) {
                // if checked and not in array
                if (checkboxes[i].checked && selected.indexOf(checkboxes[i].value) == -1) {
                    selected.push(checkboxes[i].value);
                }
            }

            selected.sort();

            showSelected();
        }

        document.getElementById("selected-clear").onclick = function() {
            selected = [];
            localStorage.setItem("selected", selected);
            showSelected();
        }

        document.getElementById("selected-show-sheet").onclick = function() {
            document.location.href = "{{ get_url('label_assets') }}?asset_ids=" + selected;
        }

        document.getElementById("selected-create-transaction").onclick = function() {
            document.location.href = "{{ get_url('transaction.create_view') }}?asset_id=[" + selected + "]";
        }

        /* Select multiple checkboxes with shift */

        var checkboxes = Array.from(document.querySelectorAll('input[type=checkbox]'));
        var lastChecked = null;

        checkboxes.forEach(function(checkbox) {
            checkbox.addEventListener('click', function(e) {
                if (!lastChecked) {
                    lastChecked = this;
                    return;
                }

                if (e.shiftKey) {
                    var start = checkboxes.indexOf(this);
                    var end = checkboxes.indexOf(lastChecked);

                    for (var i = Math.min(start,end); i <= Math.max(start,end); i++) {
                        checkboxes[i].checked = lastChecked.checked;
                    }
                }

                lastChecked = this;
            });
        });

    </script>
{% endblock %}