{% extends 'admin/model/details.html' %}

{% block details_table %}
    <h2>File: {{ model.filepath }}</h2>
    <strong>Asset:</strong>
    {% if model.asset %}
        <a href="{{ url_for('asset.details_view', id=model.asset.id) }}">{{ model.asset }}</a>
    {% else %}
        None
    {% endif %}

    <div style="margin: 8px 0 8px 0;">
        <a href="{{ url_for('files.static', filename=model.filepath) }}" class="btn btn-secondary">Download</a>
        {% if model.is_image %}
            {% if model.has_thumbnail %}
                <a href="{{ url_for('files.static', filename=model.filepath_thumbnail) }}" class="btn btn-secondary">Thumbnail</a>
            {% else %}
                <form method="POST" action="{{ url_for('file.make_thumbnail_view', id=model.id) }}" style="display: inline;">
                    <input type="submit" value="Make thumbnail" class="btn btn-primary">
                </form>
            {% endif %}
        {% endif %}
        <form method="POST" action="" style="display: inline;">
            {{ file_assign_form.asset(style='margin-bottom: 0px;') }}
            <input type="submit" value="Assign" class="btn btn-primary">
        </form>
    </div>
    {% if model.is_image %}
        <img src="{{ url_for('files.static', filename=model.filepath) }}" style="margin-bottom: 8px;">
        {% set barcodes = model.read_barcodes() %}
        {% if barcodes %}
            <h3>Decoded barcodes</h3>
            <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Data</th>
                    </tr>
                </thead>
                {% for barcode in barcodes %}
                    <tr>
                        <td>
                            {{ barcode.type }}
                        </td>
                        <td>
                            <tt>{{ barcode.data.decode('utf-8') }}</tt>
                            {% if barcode.data.decode('utf-8').startswith('RH') %}
                                <form method="POST" action="{{ url_for('file.auto_assign_view', id=model.id) }}" style="display: inline;">
                                    <input type="submit" value="Auto assign" class="btn btn-primary">
                                </form>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endif %}

    <h3>Metadata</h3>
    {{ super() }}


{% endblock %}